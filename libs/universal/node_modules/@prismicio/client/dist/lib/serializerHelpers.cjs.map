{"version":3,"file":"serializerHelpers.cjs","sources":["../../../src/lib/serializerHelpers.ts"],"sourcesContent":["import { LinkType } from \"../types/value/link\";\nimport {\n\tRTBlockNode,\n\tRTEmbedNode,\n\tRTImageNode,\n\tRTInlineNode,\n\tRTLinkNode,\n\tRTPreformattedNode,\n\tRichTextNodeType,\n} from \"../types/value/richText\";\n\nimport { LinkResolverFunction, asLink } from \"../helpers/asLink\";\n\nimport { escapeHTML } from \"./escapeHTML\";\n\nexport const getLabel = (node: RTBlockNode | RTInlineNode): string => {\n\treturn \"data\" in node && \"label\" in node.data\n\t\t? ` class=\"${node.data.label}\"`\n\t\t: \"\";\n};\n\nexport const serializeStandardTag = (\n\ttag: string,\n\tnode: RTBlockNode | RTInlineNode,\n\tchildren: string[],\n): string => {\n\treturn `<${tag}${getLabel(node)}>${children.join(\"\")}</${tag}>`;\n};\n\nexport const serializePreFormatted = (node: RTPreformattedNode): string => {\n\treturn `<pre${getLabel(node)}>${escapeHTML(node.text)}</pre>`;\n};\n\nexport const serializeImage = (\n\tlinkResolver:\n\t\t| LinkResolverFunction<string | null | undefined>\n\t\t| undefined\n\t\t| null,\n\tnode: RTImageNode,\n): string => {\n\tlet imageTag = `<img src=\"${node.url}\" alt=\"${escapeHTML(node.alt)}\"${\n\t\tnode.copyright ? ` copyright=\"${escapeHTML(node.copyright)}\"` : \"\"\n\t} />`;\n\n\t// If the image has a link, we wrap it with an anchor tag\n\tif (node.linkTo) {\n\t\timageTag = serializeHyperlink(\n\t\t\tlinkResolver,\n\t\t\t{\n\t\t\t\ttype: RichTextNodeType.hyperlink,\n\t\t\t\tdata: node.linkTo,\n\t\t\t\tstart: 0,\n\t\t\t\tend: 0,\n\t\t\t},\n\t\t\t[imageTag],\n\t\t);\n\t}\n\n\treturn `<p class=\"block-img\">${imageTag}</p>`;\n};\n\nexport const serializeEmbed = (node: RTEmbedNode): string => {\n\treturn `<div data-oembed=\"${node.oembed.embed_url}\" data-oembed-type=\"${\n\t\tnode.oembed.type\n\t}\" data-oembed-provider=\"${node.oembed.provider_name}\"${getLabel(node)}>${\n\t\tnode.oembed.html\n\t}</div>`;\n};\n\nexport const serializeHyperlink = (\n\tlinkResolver:\n\t\t| LinkResolverFunction<string | null | undefined>\n\t\t| undefined\n\t\t| null,\n\tnode: RTLinkNode,\n\tchildren: string[],\n): string => {\n\tswitch (node.data.link_type) {\n\t\tcase LinkType.Web: {\n\t\t\treturn `<a href=\"${escapeHTML(node.data.url)}\" ${\n\t\t\t\tnode.data.target ? `target=\"${node.data.target}\" ` : \"\"\n\t\t\t}rel=\"noopener noreferrer\"${getLabel(node)}>${children.join(\"\")}</a>`;\n\t\t}\n\n\t\tcase LinkType.Document: {\n\t\t\treturn `<a href=\"${asLink(node.data, linkResolver)}\"${getLabel(\n\t\t\t\tnode,\n\t\t\t)}>${children.join(\"\")}</a>`;\n\t\t}\n\n\t\tcase LinkType.Media: {\n\t\t\treturn `<a href=\"${node.data.url}\"${getLabel(node)}>${children.join(\n\t\t\t\t\"\",\n\t\t\t)}</a>`;\n\t\t}\n\t}\n};\n\nexport const serializeSpan = (content?: string): string => {\n\treturn content ? escapeHTML(content).replace(/\\n/g, \"<br />\") : \"\";\n};\n"],"names":["escapeHTML","RichTextNodeType","LinkType","asLink"],"mappings":";;;;;;AAea,MAAA,WAAW,CAAC,SAA4C;AAC7D,SAAA,UAAU,QAAQ,WAAW,KAAK,OACtC,WAAW,KAAK,KAAK,KAAK,MAC1B;AACJ;AAEO,MAAM,uBAAuB,CACnC,KACA,MACA,aACW;AACX,SAAO,IAAI,GAAG,GAAG,SAAS,IAAI,CAAC,IAAI,SAAS,KAAK,EAAE,CAAC,KAAK,GAAG;AAC7D;AAEa,MAAA,wBAAwB,CAAC,SAAoC;AAClE,SAAA,OAAO,SAAS,IAAI,CAAC,IAAIA,WAAW,WAAA,KAAK,IAAI,CAAC;AACtD;AAEa,MAAA,iBAAiB,CAC7B,cAIA,SACW;AACX,MAAI,WAAW,aAAa,KAAK,GAAG,UAAUA,sBAAW,KAAK,GAAG,CAAC,IACjE,KAAK,YAAY,eAAeA,WAAAA,WAAW,KAAK,SAAS,CAAC,MAAM,EACjE;AAGA,MAAI,KAAK,QAAQ;AAChB,eAAW,mBACV,cACA;AAAA,MACC,MAAMC,SAAiB,iBAAA;AAAA,MACvB,MAAM,KAAK;AAAA,MACX,OAAO;AAAA,MACP,KAAK;AAAA,IAAA,GAEN,CAAC,QAAQ,CAAC;AAAA,EAEX;AAED,SAAO,wBAAwB,QAAQ;AACxC;AAEa,MAAA,iBAAiB,CAAC,SAA6B;AAC3D,SAAO,qBAAqB,KAAK,OAAO,SAAS,uBAChD,KAAK,OAAO,IACb,2BAA2B,KAAK,OAAO,aAAa,IAAI,SAAS,IAAI,CAAC,IACrE,KAAK,OAAO,IACb;AACD;AAEO,MAAM,qBAAqB,CACjC,cAIA,MACA,aACW;AACH,UAAA,KAAK,KAAK,WAAW;AAAA,IAC5B,KAAKC,KAAAA,SAAS,KAAK;AACX,aAAA,YAAYF,WAAAA,WAAW,KAAK,KAAK,GAAG,CAAC,KAC3C,KAAK,KAAK,SAAS,WAAW,KAAK,KAAK,MAAM,OAAO,EACtD,4BAA4B,SAAS,IAAI,CAAC,IAAI,SAAS,KAAK,EAAE,CAAC;AAAA,IAC/D;AAAA,IAED,KAAKE,KAAAA,SAAS,UAAU;AACvB,aAAO,YAAYC,OAAA,OAAO,KAAK,MAAM,YAAY,CAAC,IAAI,SACrD,IAAI,CACJ,IAAI,SAAS,KAAK,EAAE,CAAC;AAAA,IACtB;AAAA,IAED,KAAKD,KAAAA,SAAS,OAAO;AACpB,aAAO,YAAY,KAAK,KAAK,GAAG,IAAI,SAAS,IAAI,CAAC,IAAI,SAAS,KAC9D,EAAE,CACF;AAAA,IACD;AAAA,EACD;AACF;AAEa,MAAA,gBAAgB,CAAC,YAA4B;AACzD,SAAO,UAAUF,WAAW,WAAA,OAAO,EAAE,QAAQ,OAAO,QAAQ,IAAI;AACjE;;;;;;;;"}